include $(TOPDIR)/rules.mk

PKG_NAME:=pihole-web
PKG_VERSION:=1.5
PKG_RELEASE:=1

PKG_SOURCE_VERSION:=b29a423b9553654f113bcdc8a82296eb6e4613d7
PKG_SOURCE_PROTO:=git
PKG_SOURCE_URL:=https://github.com/pi-hole/AdminLTE.git
PKG_SOURCE:=$(PKG_SOURCE_VERSION).tar.gz
PKG_MIRROR_HASH:=4668a2c61baad18a3c6cae9bf21dd5e64d012121f903d339c5ac069b6d92d146

PKG_LICENSE:=EUPL
PKG_LICENSE_FILES:=LICENSE
PKG_INSTALL:=1

PKG_BUILD_DIR:=$(BUILD_DIR)/$(PKG_NAME)/WEB-$(PKG_SOURCE_VERSION)

include $(INCLUDE_DIR)/package.mk
#+procps-ng-ps - not compat with current distro?
define Package/pihole-web
	SECTION:=net
	CATEGORY:=Pihole
	TITLE:=Pi-hole Dashboard for stats and more
	URL:=https://pi-hole.net/
	DEPENDS:=+lighttpd +lighttpd-mod-access +lighttpd-mod-fastcgi +lighttpd-mod-setenv +php8 +php8-fpm +php8-mod-openssl +php8-mod-phar +php8-mod-session +php8-mod-sqlite3 +lighttpd-mod-accesslog +lighttpd-mod-redirect +php8-cgi +php8-mod-filter
	PKGARCH:=all
endef

define Package/pihole-web/description
	Pi-hole®'s Web interface (based off of AdminLTE) provides a central location to manage your Pi-hole and review the statistics generated by FTLDNS™.
endef

define Build/Prepare
	(echo "Starting prep phase")
	$(Build/Prepare/Default)
	(cp -R $(PKG_BUILD_DIR)/../pihole-web-$(PKG_VERSION)/* $(PKG_BUILD_DIR)/)
endef

define Package/pihole-web/install
	$(INSTALL_DIR) $(1)/www/admin
	$(CP) -r $(PKG_BUILD_DIR)/{img,scripts,style,*.php} $(1)/www/admin/
endef

define Build/Compile
	(echo "Done")
endef

define Build/Install
	(echo "Done")
endef



$(eval $(call BuildPackage,pihole-web))
